<!DOCTYPE html>
<html lang="he">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>הפרופיל שלי – יאללה תקשורת</title>
    <!-- חלק ראש פרופיל (profile.html) – משתמש באותו אייקון רשת כדי לשמור על מיתוג אחיד -->
    <link rel="icon" type="image/svg+xml" href="./icons/yalla-signal.svg" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="stylesheet" href="./styles/facebook-theme.css" />
    <link rel="stylesheet" href="./styles/profile.css" />
    <!-- חלק סגנונות הכרויות (profile.html) – טוען התאמות עיצוב לרכיבי ההכרויות החדשים -->
    <link rel="stylesheet" href="./styles/dating.css" />
    <link rel="stylesheet" href="./styles/media-overrides.css" />
    <script src="./auth-guard.js"></script>
  </head>
  <body class="profile-body" dir="rtl">
    <!-- חלק חיווי חיבור (profile.html) – מציג מצב טעינת ריליים בדומה לעמוד הראשי -->
    <div id="connection-status" class="profile-connection" hidden>מתחבר לריליים...</div>

    <!-- חלק סרגל עליון (profile.html) – לוגו SOS בצד שמאל וכפתור בית יחיד בצד ימין -->
    <header class="top-bar top-bar--profile">
      <div class="top-bar__actions top-bar__actions--profile">
        <button class="circle-button top-bar__refresh" id="profileTopRefreshButton" type="button" aria-label="רענון הדף">
          <i class="fa-solid fa-rotate-right"></i>
        </button>
      </div>
      <div class="top-bar__title" id="profileTopTitle">הפרופיל שלי</div>
      <div class="top-bar__actions top-bar__actions--profile">
        <button class="circle-button top-bar__home" id="profileTopHomeButton" type="button" aria-label="חזרה לדף הבית">
          <i class="fa-solid fa-house"></i>
        </button>
      </div>
    </header>

    <!-- חלק מעטפת פרופיל (profile.html) – מציג כיסוי, אווטר ופרטי מפתח -->
    <main class="app-shell profile-shell">
      <section class="profile-cover" id="profilePageCover">
        <!-- חלק תמונת נושא (profile.html) – באנר כיסוי עליון עם פרטי המשתמש מעליו -->
        <div class="profile-cover__banner" id="profilePageCoverBanner">
          <div class="profile-cover__inner">
            <div class="profile-cover__avatar" id="profilePageAvatar">?</div>
            <div class="profile-cover__info">
              <h1 class="profile-cover__name" id="profilePageName">משתמש</h1>
              <p class="profile-cover__bio" id="profilePageBio">מעדכנים את תיאור הפרופיל...</p>
              <!-- חלק עוקבים (profile.html) – מציג את ספירת העוקבים האישית ליד שם המשתמש -->
              <div class="profile-cover__stats profile-follow__summary" id="profileFollowSummary">
                <span class="profile-follow__count" id="profileFollowersCount">0 עוקבים</span>
                <ul class="profile-cover__followers" id="profileCoverFollowers"></ul>
              </div>
              <div class="profile-cover__actions">
                <button class="profile-primary-button" id="profileEditButton">
                  <i class="fa-solid fa-pen"></i>
                  עריכת פרופיל
                </button>
                <button class="profile-secondary-button" id="profileHomeButton">
                  <i class="fa-solid fa-house"></i>
                  חזרה לפיד
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- חלק טאבים מובייל (profile.html) – תפריט סקשנים בדומה לאפליקציות חברתיות -->
      <nav class="profile-mobile-tabs" id="profileMobileTabs" aria-label="ניווט פרופיל במובייל">
        <button type="button" class="profile-mobile-tab is-active" data-profile-tab="about" aria-controls="profileAboutPanel">
          אודות
        </button>
        <button type="button" class="profile-mobile-tab" data-profile-tab="gallery" aria-controls="profileGalleryPanel">
          גלריה
        </button>
        <button type="button" class="profile-mobile-tab" data-profile-tab="dating" aria-controls="profileDatingPanel">
          הכרויות
        </button>
        <button type="button" class="profile-mobile-tab" data-profile-tab="posts" aria-controls="profilePostsPanel">
          פוסטים
        </button>
      </nav>

      <!-- חלק תוכן ראשי (profile.html) – דומה לפרופיל פייסבוק עם עמודת מידע ועמודת טיימליין -->
      <section class="profile-main">
        <aside class="profile-sidebar">
          <section class="profile-card" data-profile-panel="about" id="profileAboutPanel">
            <h2 class="profile-card__title">אודות</h2>
            <div class="profile-about">
              <p class="profile-about__summary" id="profileSidebarBio">לא הוגדר עדיין תיאור קצר.</p>
              <ul class="profile-about__list">
                <li class="profile-about__item" id="profileAboutHeadlineRow" hidden>
                  <i class="fa-solid fa-address-card" aria-hidden="true"></i>
                  <span id="profileAboutHeadline">כותרת מקצועית</span>
                </li>
                <li class="profile-about__item" id="profileAboutRoleRow" hidden>
                  <i class="fa-solid fa-briefcase" aria-hidden="true"></i>
                  <div class="profile-about__item-text">
                    <span class="profile-about__item-title" id="profileAboutRole">תפקיד</span>
                    <span class="profile-about__item-subtitle" id="profileAboutCompany">בשם הארגון</span>
                  </div>
                </li>
                <li class="profile-about__item" id="profileAboutLocationRow" hidden>
                  <i class="fa-solid fa-location-dot" aria-hidden="true"></i>
                  <span id="profileAboutLocation">מיקום</span>
                </li>
                <li class="profile-about__item" id="profileAboutWebsiteRow" hidden>
                  <i class="fa-solid fa-link" aria-hidden="true"></i>
                  <a id="profileAboutWebsite" href="#" target="_blank" rel="noopener">לאתר אישי</a>
                </li>
              </ul>
            </div>
          </section>

          <!-- חלק גלריית פרופיל (profile.html) – מציג ומנהל תמונות נוספות של המשתמש -->
          <section class="profile-card profile-card--gallery" data-profile-panel="gallery" id="profileGalleryPanel">
            <h2 class="profile-card__title">גלריה</h2>
            <div class="profile-gallery__uploader" id="profileGalleryDropZone">
              <input id="profileGalleryFileInput" type="file" accept="image/*,video/*" multiple hidden />
              <i class="fa-solid fa-cloud-arrow-up" aria-hidden="true"></i>
              <span>גררו לכאן תמונות חדשות או לחצו לבחירה</span>
              <button type="button" id="profileGalleryAddButton">הוספת תמונות</button>
            </div>
            <ul class="profile-gallery" id="profileGallery"></ul>
            <div class="profile-gallery__status" id="profileGalleryStatus"></div>
          </section>

          <!-- חלק הכרות (profile.html) – מאפשר למשתמש להצטרף לשירות ההכרויות ולהזין פרטים בסיסיים -->
          <section class="profile-card" id="profileDatingCard" data-profile-panel="dating" aria-labelledby="profileDatingPanel">
            <h2 class="profile-card__title">הכרויות</h2>
            <div class="profile-dating__row">
              <label class="profile-dating__optin" for="profileDatingOptIn">
                <input type="checkbox" id="profileDatingOptIn" />
                <span>הצטרפות להצגת הפרופיל בהכרויות</span>
              </label>
              <p class="profile-dating__note">ברגע שתאשר/י, משתמשים אחרים יוכלו לראות אותך בדף ההכרויות ולשלוח לייק.</p>
            </div>
            <button class="profile-secondary-button profile-dating__edit" id="profileDatingEditButton" type="button" hidden>
              <i class="fa-solid fa-pen-to-square"></i>
              עריכת פרטי הכרויות
            </button>
            <div class="profile-dating__fields" id="profileDatingFields" hidden>
              <label class="profile-dating__label" for="profileDatingBio">תיאור קצר</label>
              <textarea id="profileDatingBio" rows="2" maxlength="200" placeholder="כמה מילים עליך..."></textarea>
              <label class="profile-dating__label" for="profileDatingAge">גיל</label>
              <input id="profileDatingAge" type="number" min="18" max="120" placeholder="לדוגמה 29" />
              <label class="profile-dating__label" for="profileDatingLocation">מיקום</label>
              <input id="profileDatingLocation" type="text" maxlength="80" placeholder="עיר / אזור" />
              <label class="profile-dating__label" for="profileDatingInterests">תחומי עניין (מופרדים בפסיק)</label>
              <input id="profileDatingInterests" type="text" maxlength="160" placeholder="ים, מוזיקה, טיולים" />
              <div class="profile-dating__actions">
                <button class="profile-secondary-button profile-dating__save" id="profileDatingSaveButton" type="button">
                  <i class="fa-solid fa-heart-circle-check"></i>
                  שמור
                </button>
                <button class="profile-secondary-button profile-dating__close" id="profileDatingCloseButton" type="button">
                  <i class="fa-solid fa-circle-xmark"></i>
                  סגור
                </button>
              </div>
              <div class="profile-status" id="profileDatingStatus"></div>
            </div>
          </section>

          <section class="profile-card" data-profile-panel="about">
            <h2 class="profile-card__title">נתוני פעילות</h2>
            <!-- חלק נתוני פעילות (profile.html) – מציג גרף דינמי עם תקופות בחירה כמו בפייסבוק -->
            <div class="profile-activity">
              <div class="profile-activity__controls">
                <div class="profile-activity__summary">
                  <div class="profile-activity__summary-item">
                    <div class="profile-activity__summary-heading">
                      <span class="profile-activity__summary-label">פוסטים</span>
                      <span class="profile-activity__summary-change is-neutral" id="profileStatsPostsChange">0%</span>
                    </div>
                    <span class="profile-activity__summary-value" id="profileStatsPosts">0</span>
                    <span class="profile-activity__summary-note" id="profileStatsPostsNote">אין שינוי לעומת התקופה הקודמת</span>
                  </div>
                  <div class="profile-activity__summary-item">
                    <div class="profile-activity__summary-heading">
                      <span class="profile-activity__summary-label">לייקים</span>
                      <span class="profile-activity__summary-change is-neutral" id="profileStatsLikesChange">0%</span>
                    </div>
                    <span class="profile-activity__summary-value" id="profileStatsLikes">0</span>
                    <span class="profile-activity__summary-note" id="profileStatsLikesNote">אין שינוי לעומת התקופה הקודמת</span>
                  </div>
                  <div class="profile-activity__summary-item">
                    <div class="profile-activity__summary-heading">
                      <span class="profile-activity__summary-label">תגובות שנאספו</span>
                      <span class="profile-activity__summary-change is-neutral" id="profileStatsCommentsChange">0%</span>
                    </div>
                    <span class="profile-activity__summary-value" id="profileStatsComments">0</span>
                    <span class="profile-activity__summary-note" id="profileStatsCommentsNote">אין שינוי לעומת התקופה הקודמת</span>
                  </div>
                  <div class="profile-activity__summary-item">
                    <div class="profile-activity__summary-heading">
                      <span class="profile-activity__summary-label">תגובות שנשלחו</span>
                      <span class="profile-activity__summary-change is-neutral" id="profileStatsRepliesChange">0%</span>
                    </div>
                    <span class="profile-activity__summary-value" id="profileStatsReplies">0</span>
                    <span class="profile-activity__summary-note" id="profileStatsRepliesNote">אין שינוי לעומת התקופה הקודמת</span>
                  </div>
                </div>
                <div class="profile-activity__periods" role="group" aria-label="בחירת טווח זמן">
                  <button type="button" class="profile-activity__period" data-activity-period="7">7 ימים</button>
                  <button type="button" class="profile-activity__period" data-activity-period="30">30 ימים</button>
                  <button type="button" class="profile-activity__period is-active" data-activity-period="60">60 ימים</button>
                </div>
              </div>
              <div class="profile-activity__chart" id="profileActivityChart"></div>
              <div class="profile-activity__empty" id="profileActivityEmpty" hidden>
                עדיין לא נרשמה פעילות בתקופה שנבחרה.
              </div>
            </div>
          </section>

          <!-- חלק עוקבים (profile.html) – מציג את רשימת העוקבים האישית והחיווי הנוכחי -->
          <section class="profile-card" id="profileFollowersCard" data-profile-panel="about">
            <h2 class="profile-card__title profile-card__title--with-count">
              <span>עוקבים</span>
              <span class="profile-card__count" id="profileFollowersCountLabel">0</span>
            </h2>
            <ul class="profile-followers__list" id="profileFollowersList"></ul>
            <div class="profile-status" id="profileFollowersStatus"></div>
          </section>

          <section class="profile-card" data-profile-panel="about">
            <h2 class="profile-card__title">קישורים מהירים</h2>
            <div class="profile-quick-links">
              <button class="profile-secondary-button profile-quick-links__button" id="profileQuickCompose">
                <i class="fa-solid fa-square-pen"></i>
                פוסט חדש
              </button>
            </div>
          </section>

          <!-- חלק תגובות שהגבנו (profile.html) – כרטיסייה מכווצת בתוך 'אודות' עם כפתור פתיחה/סגירה -->
          <section class="profile-card" id="profileRepliesCard" data-profile-panel="about">
            <div class="profile-card__header-row">
              <h2 class="profile-card__title">תגובות שהגבנו</h2>
              <button type="button" class="profile-card__toggle" id="profileRepliesToggle" aria-expanded="false" aria-controls="profileTimelineComments">הצג</button>
            </div>
            <div class="profile-followers__count" id="profileRepliesCountLabel">0 תגובות</div>
            <ul class="profile-timeline__list" id="profileTimelineComments" hidden></ul>
          </section>
        </aside>

        <section class="profile-timeline" data-profile-panel="posts" id="profilePostsPanel">
          <header class="profile-timeline__header">
            <h2 class="profile-timeline__title">הפוסטים שלי</h2>
            <div class="profile-timeline__actions">
              <button class="profile-secondary-button" id="profileRefreshPosts">
                <i class="fa-solid fa-rotate"></i>
                רענון
              </button>
            </div>
          </header>
          <div class="profile-status" id="profileTimelineStatus"></div>
          <ul class="profile-timeline__list" id="profileTimeline"></ul>
        </section>
      </section>

    </main>

    <!-- חלק דיאלוגים (profile.html) – הודעת רענון קולנועית לאחר החלפת תמונה -->
    <dialog class="profile-dialog profile-dialog--info" id="profileInfoDialog">
      <div class="profile-dialog__backdrop" aria-hidden="true"></div>
      <div class="profile-dialog__content" role="document">
        <div class="profile-dialog__icon profile-dialog__icon--info" aria-hidden="true">
          <i class="fa-solid fa-arrows-rotate"></i>
        </div>
        <h3 class="profile-dialog__title" id="profileInfoDialogTitle">רענון מומלץ</h3>
        <p class="profile-dialog__message" id="profileInfoDialogMessage">
          התמונה עודכנה. אם אינך רואה שינוי מידי, רענן את הדף.
        </p>
        <div class="profile-dialog__actions">
          <button type="button" class="profile-dialog__button profile-dialog__button--confirm" id="profileInfoDialogClose">
            הבנתי
          </button>
        </div>
      </div>
    </dialog>

    <!-- חלק דיאלוגים (profile.html) – שאלה קולנועית לאישור מחיקת תמונת פרופיל -->
    <dialog class="profile-dialog" id="profileAvatarDialog">
      <div class="profile-dialog__backdrop" aria-hidden="true"></div>
      <div class="profile-dialog__content" role="document">
        <div class="profile-dialog__icon" aria-hidden="true">
          <i class="fa-solid fa-camera-rotate"></i>
        </div>
        <h3 class="profile-dialog__title">להחליף את תמונת הפרופיל?</h3>
        <p class="profile-dialog__message">
          התמונה הנוכחית תימחק ונפתח עבורך חלון לבחירת תמונה חדשה מהמכשיר. האם להמשיך?
        </p>
        <div class="profile-dialog__actions">
          <button type="button" class="profile-dialog__button profile-dialog__button--cancel" id="profileAvatarDialogCancel">
            ביטול
          </button>
          <button type="button" class="profile-dialog__button profile-dialog__button--confirm" id="profileAvatarDialogConfirm">
            כן, החליפו
          </button>
        </div>
      </div>
    </dialog>

    <!-- חלק דיאלוגים (profile.html) – שאלה קולנועית לאישור מחיקת תמונת נושא -->
    <dialog class="profile-dialog" id="profileCoverDialog">
      <div class="profile-dialog__backdrop" aria-hidden="true"></div>
      <div class="profile-dialog__content" role="document">
        <div class="profile-dialog__icon" aria-hidden="true">
          <i class="fa-solid fa-image"></i>
        </div>
        <h3 class="profile-dialog__title">להחליף את תמונת הנושא?</h3>
        <p class="profile-dialog__message">
          תמונת הנושא הנוכחית תימחק ונפתח עבורך חלון לבחירת תמונה חדשה מהמכשיר. האם להמשיך?
        </p>
        <div class="profile-dialog__actions">
          <button type="button" class="profile-dialog__button profile-dialog__button--cancel" id="profileCoverDialogCancel">
            ביטול
          </button>
          <button type="button" class="profile-dialog__button profile-dialog__button--confirm" id="profileCoverDialogConfirm">
            כן, החליפו
          </button>
        </div>
      </div>
    </dialog>

    <!-- חלק חלון עריכת פרופיל (profile.html) – זהה למודל הראשי כדי לשמור תאימות ל-profile.js -->
    <div class="modal" id="profileModal">
      <div class="modal-content">
        <h2>עריכת פרופיל</h2>
        <label for="profileNameInput">שם משתמש</label>
        <input id="profileNameInput" type="text" placeholder="הכנס שם מלא" />
        <label for="profileBioInput">תיאור קצר</label>
        <textarea id="profileBioInput" rows="3" placeholder="ספר על עצמך"></textarea>
        <label for="profileHeadlineInput">כותרת מקצועית</label>
        <input id="profileHeadlineInput" type="text" maxlength="120" placeholder="לדוגמה: פרופיל · יוצר תוכן דיגיטלי" />
        <label for="profileRoleInput">תפקיד נוכחי</label>
        <input id="profileRoleInput" type="text" maxlength="80" placeholder="Owner and CEO" />
        <label for="profileCompanyInput">חברה / ארגון</label>
        <input id="profileCompanyInput" type="text" maxlength="80" placeholder="Hyper Core Tech" />
        <label for="profileLocationInput">מיקום</label>
        <input id="profileLocationInput" type="text" maxlength="80" placeholder="תל אביב, ישראל" />
        <label for="profileWebsiteInput">אתר אינטרנט</label>
        <input id="profileWebsiteInput" type="url" placeholder="https://example.com" />
        <!-- חלק תמונת נושא הוסר מהמודאל: שינוי/מחיקה מטופלים בלחיצה על הבאנר עצמו -->
        <div class="modal-actions">
          <button class="profile-primary-button" id="profileSaveButton" type="button">
            <i class="fa-solid fa-floppy-disk"></i>
            שמור שינויים
          </button>
          <button class="profile-secondary-button" id="profileCancelButton" type="button">
            <i class="fa-solid fa-circle-xmark"></i>
            ביטול
          </button>
        </div>

        <!-- חלק סטטוס עריכת פרופיל (profile.html) – מציג חיווי בעת שמירת הנתונים או שגיאות תוקף -->
        <div class="profile-status" id="profileStatus"></div>

    <!-- חלק מודלי מפתחות (profile.html) – מאפשר להציג ולהוריד מפתח ללא מעבר לעמוד הראשי -->
    <div class="modal" id="keyModal" hidden>
      <div class="modal-content key-modal">
        <h2>המפתח הפרטי שלך</h2>
        <textarea id="keyViewerTextarea" readonly></textarea>
        <div class="modal-actions">
          <button class="icon-button" id="profileCopyPrivateKeyConfirm">העתק</button>
          <button class="button-secondary" id="profileClosePrivateKey">סגור</button>
        </div>
        <div class="profile-status" id="keyViewerStatus"></div>
      </div>
    </div>

    <!-- חלק מודל גלריה (profile.html) – מציג תמונה מוגדלת כאשר לוחצים על פריט בגלריה -->
    <div class="profile-gallery-modal" id="profileGalleryModal" hidden>
      <button class="profile-gallery-modal__close" id="profileGalleryModalClose" type="button" aria-label="סגירת תמונת גלריה">×</button>
      <img class="profile-gallery-modal__image" id="profileGalleryModalImage" alt="תצוגת גלריה" />
    </div>

    <!-- חלק סקריפטים (profile.html) – טוען את כל הלוגיקה הנדרשת לפרופיל אישי -->
    <script src="https://unpkg.com/nostr-tools@2.7.2/lib/nostr.bundle.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="./config.js"></script>
    <script src="./utils.js"></script>
    <script src="./key-utils.js"></script>
    <script src="./keys.js"></script>
    <!-- חלק עוקבים (profile.html) – טוען את שירות המעקב המשותף לדפים אחרים -->
    <script src="./follow-service.js"></script>
    <script src="./profile.js"></script>
    <script src="./profile-engagement.js"></script>
    <script src="./profile-post.js"></script>
    <script src="./profile-view.js"></script>
  </body>
</html>
